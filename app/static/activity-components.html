<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity Tracking & Permission Management - Components</title>
    <style>
        /* ==================== Activity Log Timeline ==================== */
        .activity-timeline {
            position: relative;
            padding: 20px 0;
            margin: 20px 0;
        }

        .activity-timeline::before {
            content: '';
            position: absolute;
            left: 30px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e0e0e0;
        }

        .activity-item {
            position: relative;
            padding-left: 70px;
            margin-bottom: 30px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .activity-icon {
            position: absolute;
            left: 17px;
            top: 0;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 1;
        }

        .activity-icon.create {
            background: #4CAF50;
            color: white;
        }

        .activity-icon.update {
            background: #2196F3;
            color: white;
        }

        .activity-icon.delete {
            background: #f44336;
            color: white;
        }

        .activity-icon.approve {
            background: #8BC34A;
            color: white;
        }

        .activity-icon.reject {
            background: #FF5722;
            color: white;
        }

        .activity-icon.login {
            background: #9C27B0;
            color: white;
        }

        .activity-icon.permission {
            background: #FF9800;
            color: white;
        }

        .activity-content {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.2s;
        }

        .activity-content:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 8px;
        }

        .activity-title {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .activity-time {
            font-size: 12px;
            color: #999;
            white-space: nowrap;
        }

        .activity-description {
            color: #666;
            font-size: 13px;
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .activity-meta {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            font-size: 12px;
            color: #888;
        }

        .activity-meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .activity-changes {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 12px;
        }

        .activity-changes-row {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 10px;
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .activity-changes-row:last-child {
            border-bottom: none;
        }

        .old-value {
            color: #f44336;
            text-decoration: line-through;
            text-align: right;
        }

        .new-value {
            color: #4CAF50;
        }

        .activity-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .activity-badge.success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .activity-badge.error {
            background: #ffebee;
            color: #c62828;
        }

        .activity-badge.warning {
            background: #fff3e0;
            color: #e65100;
        }

        .activity-badge.info {
            background: #e3f2fd;
            color: #1565c0;
        }

        /* ==================== Permission Matrix ==================== */
        .permission-matrix {
            overflow-x: auto;
            margin: 20px 0;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .permission-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .permission-table th {
            background: #f5f5f5;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e0e0e0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .permission-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .permission-table tr:hover {
            background: #fafafa;
        }

        .permission-check {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #2196F3;
        }

        .permission-module {
            font-weight: 500;
            color: #2196F3;
        }

        .permission-action {
            font-size: 12px;
            color: #666;
        }

        /* ==================== Role Card ==================== */
        .role-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            transition: all 0.2s;
        }

        .role-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .role-card.system-role {
            border-left: 4px solid #2196F3;
        }

        .role-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .role-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .role-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .role-stats {
            display: flex;
            gap: 20px;
            font-size: 13px;
            color: #888;
        }

        .role-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .role-stat-value {
            font-weight: 600;
            color: #2196F3;
        }

        .role-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .role-badge.active {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .role-badge.inactive {
            background: #ffebee;
            color: #c62828;
        }

        .role-badge.system {
            background: #e3f2fd;
            color: #1565c0;
        }

        /* ==================== User Permission Summary ==================== */
        .user-permission-summary {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .permission-summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .permission-summary-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .user-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .user-role {
            font-size: 13px;
            color: #666;
        }

        .permission-sections {
            display: grid;
            gap: 20px;
        }

        .permission-section {
            border: 1px solid #f0f0f0;
            border-radius: 6px;
            padding: 15px;
        }

        .permission-section-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .permission-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
        }

        .permission-item {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .permission-name {
            font-weight: 500;
            color: #333;
        }

        .permission-source {
            font-size: 10px;
            color: #888;
            font-style: italic;
        }

        .permission-temp {
            color: #ff9800;
        }

        /* ==================== Approval Widget ==================== */
        .approval-widget {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }

        .approval-entity {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .approval-entity-info h4 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .approval-entity-ref {
            font-size: 13px;
            color: #2196F3;
        }

        .approval-flow {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .approval-state {
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            border: 2px solid;
        }

        .approval-state.pending {
            background: #fff3e0;
            border-color: #ff9800;
            color: #e65100;
        }

        .approval-state.approved {
            background: #e8f5e9;
            border-color: #4CAF50;
            color: #2e7d32;
        }

        .approval-state.rejected {
            background: #ffebee;
            border-color: #f44336;
            color: #c62828;
        }

        .approval-arrow {
            font-size: 20px;
            color: #999;
        }

        .approval-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .approval-btn {
            flex: 1;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .approval-btn.approve {
            background: #4CAF50;
            color: white;
        }

        .approval-btn.approve:hover {
            background: #45a049;
        }

        .approval-btn.reject {
            background: #f44336;
            color: white;
        }

        .approval-btn.reject:hover {
            background: #da190b;
        }

        .approval-comments {
            margin-top: 15px;
        }

        .approval-comments textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-family: inherit;
            font-size: 13px;
            resize: vertical;
        }

        /* ==================== Filter Panel ==================== */
        .filter-panel {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .filter-field {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-field label {
            font-size: 12px;
            font-weight: 500;
            color: #666;
        }

        .filter-field select,
        .filter-field input {
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 13px;
            font-family: inherit;
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .filter-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn.apply {
            background: #2196F3;
            color: white;
        }

        .filter-btn.reset {
            background: #f0f0f0;
            color: #666;
        }

        /* ==================== Stats Cards ==================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s;
        }

        .stat-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .stat-header {
            font-size: 13px;
            color: #888;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .stat-change {
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-change.positive {
            color: #4CAF50;
        }

        .stat-change.negative {
            color: #f44336;
        }

        /* ==================== Utility Classes ==================== */
        .text-muted {
            color: #999;
        }

        .text-success {
            color: #4CAF50;
        }

        .text-error {
            color: #f44336;
        }

        .text-warning {
            color: #ff9800;
        }

        .text-info {
            color: #2196F3;
        }

        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .btn-icon:hover {
            background: #f0f0f0;
        }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2196F3;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 16px;
        }
    </style>
</head>

<body>

    <!-- Activity Timeline Component -->
    <div class="activity-timeline" id="activityTimeline">
        <!-- Example Activity Items -->
        <div class="activity-item">
            <div class="activity-icon create">‚ûï</div>
            <div class="activity-content">
                <div class="activity-header">
                    <div class="activity-title">Purchase Order Created</div>
                    <div class="activity-time">2 hours ago</div>
                </div>
                <div class="activity-description">
                    Created purchase order PO-2024-001 for supplier ABC Corp worth $15,500
                </div>
                <div class="activity-meta">
                    <div class="activity-meta-item">
                        <span>üë§</span>
                        <span>John Doe</span>
                    </div>
                    <div class="activity-meta-item">
                        <span>üè¢</span>
                        <span>Main Branch</span>
                    </div>
                    <div class="activity-meta-item">
                        <span class="activity-badge success">Success</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="activity-item">
            <div class="activity-icon approve">‚úì</div>
            <div class="activity-content">
                <div class="activity-header">
                    <div class="activity-title">Invoice Approved</div>
                    <div class="activity-time">5 hours ago</div>
                </div>
                <div class="activity-description">
                    Approved invoice INV-2024-456 for $3,250.00
                </div>
                <div class="activity-meta">
                    <div class="activity-meta-item">
                        <span>üë§</span>
                        <span>Jane Smith</span>
                    </div>
                    <div class="activity-meta-item">
                        <span>üìù</span>
                        <span>Comments: "Approved for payment"</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="activity-item">
            <div class="activity-icon permission">üîë</div>
            <div class="activity-content">
                <div class="activity-header">
                    <div class="activity-title">Role Assigned</div>
                    <div class="activity-time">1 day ago</div>
                </div>
                <div class="activity-description">
                    Assigned "Accountant" role to user Mike Johnson
                </div>
                <div class="activity-changes">
                    <div class="activity-changes-row">
                        <div class="old-value">No Role</div>
                        <div>‚Üí</div>
                        <div class="new-value">Accountant</div>
                    </div>
                </div>
                <div class="activity-meta">
                    <div class="activity-meta-item">
                        <span>üë§</span>
                        <span>Admin User</span>
                    </div>
                    <div class="activity-meta-item">
                        <span>üìã</span>
                        <span>Reason: "New hire onboarding"</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Permission Matrix Component -->
    <div class="permission-matrix">
        <table class="permission-table">
            <thead>
                <tr>
                    <th>Module</th>
                    <th>Permission</th>
                    <th>Create</th>
                    <th>Read</th>
                    <th>Update</th>
                    <th>Delete</th>
                    <th>Approve</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="3" class="permission-module">Sales</td>
                    <td class="permission-action">Invoices</td>
                    <td><input type="checkbox" class="permission-check" checked></td>
                    <td><input type="checkbox" class="permission-check" checked></td>
                    <td><input type="checkbox" class="permission-check" checked></td>
                    <td><input type="checkbox" class="permission-check"></td>
                    <td><input type="checkbox" class="permission-check" checked></td>
                </tr>
                <tr>
                    <td class="permission-action">Quotes</td>
                    <td><input type="checkbox" class="permission-check" checked></td>
                    <td><input type="checkbox" class="permission-check" checked></td>
                    <td><input type="checkbox" class="permission-check"></td>
                    <td><input type="checkbox" class="permission-check"></td>
                    <td><input type="checkbox" class="permission-check"></td>
                </tr>
                <tr>
                    <td class="permission-action">Customers</td>
                    <td><input type="checkbox" class="permission-check" checked></td>
                    <td><input type="checkbox" class="permission-check" checked></td>
                    <td><input type="checkbox" class="permission-check" checked></td>
                    <td><input type="checkbox" class="permission-check"></td>
                    <td><input type="checkbox" class="permission-check"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Role Card Component -->
    <div class="role-card system-role">
        <div class="role-header">
            <div>
                <div class="role-name">Super Admin</div>
            </div>
            <div>
                <span class="role-badge system">System Role</span>
                <span class="role-badge active">Active</span>
            </div>
        </div>
        <div class="role-description">
            Full system access with all permissions. Can manage users, roles, and system settings.
        </div>
        <div class="role-stats">
            <div class="role-stat">
                <span>üë• Users:</span>
                <span class="role-stat-value">3</span>
            </div>
            <div class="role-stat">
                <span>üîë Permissions:</span>
                <span class="role-stat-value">142</span>
            </div>
        </div>
    </div>

    <!-- User Permission Summary Component -->
    <div class="user-permission-summary">
        <div class="permission-summary-header">
            <div class="permission-summary-user">
                <div class="user-avatar">JD</div>
                <div class="user-info">
                    <div class="user-name">John Doe</div>
                    <div class="user-role">Super Admin</div>
                </div>
            </div>
            <button class="filter-btn apply">Edit Permissions</button>
        </div>

        <div class="permission-sections">
            <div class="permission-section">
                <div class="permission-section-title">
                    üé≠ Role Permissions (45)
                </div>
                <div class="permission-list">
                    <div class="permission-item">
                        <span class="permission-name">sales.create.all</span>
                        <span class="permission-source">from role</span>
                    </div>
                    <div class="permission-item">
                        <span class="permission-name">sales.update.all</span>
                        <span class="permission-source">from role</span>
                    </div>
                    <div class="permission-item">
                        <span class="permission-name">purchases.approve.all</span>
                        <span class="permission-source">from role</span>
                    </div>
                </div>
            </div>

            <div class="permission-section">
                <div class="permission-section-title">
                    ‚≠ê User-Specific Permissions (2)
                </div>
                <div class="permission-list">
                    <div class="permission-item">
                        <span class="permission-name permission-temp">reports.export.all</span>
                        <span class="permission-source">expires in 30 days</span>
                    </div>
                    <div class="permission-item">
                        <span class="permission-name">inventory.audit.all</span>
                        <span class="permission-source">permanent</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Panel Component -->
    <div class="filter-panel">
        <div class="filter-grid">
            <div class="filter-field">
                <label>User</label>
                <select>
                    <option>All Users</option>
                    <option>John Doe</option>
                    <option>Jane Smith</option>
                </select>
            </div>
            <div class="filter-field">
                <label>Module</label>
                <select>
                    <option>All Modules</option>
                    <option>Sales</option>
                    <option>Purchases</option>
                    <option>Inventory</option>
                </select>
            </div>
            <div class="filter-field">
                <label>Activity Type</label>
                <select>
                    <option>All Types</option>
                    <option>Create</option>
                    <option>Update</option>
                    <option>Delete</option>
                    <option>Approve</option>
                </select>
            </div>
            <div class="filter-field">
                <label>Date From</label>
                <input type="date">
            </div>
            <div class="filter-field">
                <label>Date To</label>
                <input type="date">
            </div>
        </div>
        <div class="filter-actions">
            <button class="filter-btn apply">Apply Filters</button>
            <button class="filter-btn reset">Reset</button>
        </div>
    </div>

    <!-- Stats Cards Component -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-header">Total Activities</div>
            <div class="stat-value">1,247</div>
            <div class="stat-change positive">
                <span>‚Üë</span>
                <span>12% from last week</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-header">Approvals Pending</div>
            <div class="stat-value">23</div>
            <div class="stat-change negative">
                <span>‚Üì</span>
                <span>5 from yesterday</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-header">Active Users</div>
            <div class="stat-value">47</div>
            <div class="stat-change positive">
                <span>‚Üë</span>
                <span>3 new this month</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-header">Permission Changes</div>
            <div class="stat-value">8</div>
            <div class="stat-change">
                <span>‚Üí</span>
                <span>No change</span>
            </div>
        </div>
    </div>

    <script>
        /**
         * Activity Timeline Component
         * Renders and manages activity logs with timeline visualization
         */
        class ActivityTimeline {
            constructor(containerId) {
                this.container = document.getElementById(containerId);
                this.activities = [];
            }

            async loadActivities(filters = {}) {
                try {
                    const params = new URLSearchParams(filters);
                    const response = await fetch(`/api/v1/activity/logs?${params}`);
                    this.activities = await response.json();
                    this.render();
                } catch (error) {
                    console.error('Failed to load activities:', error);
                    this.showError();
                }
            }

            render() {
                if (this.activities.length === 0) {
                    this.container.innerHTML = this.getEmptyState();
                    return;
                }

                this.container.innerHTML = this.activities.map(activity =>
                    this.renderActivityItem(activity)
                ).join('');
            }

            renderActivityItem(activity) {
                const iconClass = this.getActivityIcon(activity.activity_type);
                const timeAgo = this.formatTimeAgo(activity.performed_at);

                return `
            <div class="activity-item">
                <div class="activity-icon ${activity.activity_type}">${iconClass}</div>
                <div class="activity-content">
                    <div class="activity-header">
                        <div class="activity-title">${activity.action}</div>
                        <div class="activity-time">${timeAgo}</div>
                    </div>
                    <div class="activity-description">
                        ${activity.description || 'No description'}
                    </div>
                    ${this.renderChanges(activity.old_values, activity.new_values)}
                    <div class="activity-meta">
                        <div class="activity-meta-item">
                            <span>üë§</span>
                            <span>${activity.username}</span>
                        </div>
                        ${activity.branch_name ? `
                            <div class="activity-meta-item">
                                <span>üè¢</span>
                                <span>${activity.branch_name}</span>
                            </div>
                        ` : ''}
                        <div class="activity-meta-item">
                            <span class="activity-badge ${activity.success ? 'success' : 'error'}">
                                ${activity.success ? 'Success' : 'Failed'}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        `;
            }

            renderChanges(oldValues, newValues) {
                if (!oldValues && !newValues) return '';

                const changes = Object.keys(newValues || {}).map(key => {
                    const oldVal = oldValues?.[key] || 'None';
                    const newVal = newValues[key];
                    return `
                <div class="activity-changes-row">
                    <div class="old-value">${oldVal}</div>
                    <div>‚Üí</div>
                    <div class="new-value">${newVal}</div>
                </div>
            `;
                }).join('');

                return changes ? `<div class="activity-changes">${changes}</div>` : '';
            }

            getActivityIcon(type) {
                const icons = {
                    create: '‚ûï',
                    update: '‚úèÔ∏è',
                    delete: 'üóëÔ∏è',
                    approve: '‚úì',
                    reject: '‚úó',
                    login: 'üîê',
                    permission: 'üîë'
                };
                return icons[type] || 'üìù';
            }

            formatTimeAgo(timestamp) {
                const now = new Date();
                const time = new Date(timestamp);
                const diff = Math.floor((now - time) / 1000);

                if (diff < 60) return 'just now';
                if (diff < 3600) return `${Math.floor(diff / 60)} minutes ago`;
                if (diff < 86400) return `${Math.floor(diff / 3600)} hours ago`;
                return `${Math.floor(diff / 86400)} days ago`;
            }

            getEmptyState() {
                return `
            <div class="empty-state">
                <div class="empty-state-icon">üìã</div>
                <div class="empty-state-text">No activities found</div>
            </div>
        `;
            }

            showError() {
                this.container.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">‚ö†Ô∏è</div>
                <div class="empty-state-text">Failed to load activities</div>
            </div>
        `;
            }
        }

        /**
         * Permission Manager Component
         * Handles permission assignments and role management
         */
        class PermissionManager {
            constructor() {
                this.permissions = [];
                this.roles = [];
            }

            async loadPermissions() {
                const response = await fetch('/api/v1/activity/permissions');
                this.permissions = await response.json();
            }

            async loadRoles() {
                const response = await fetch('/api/v1/activity/roles');
                this.roles = await response.json();
            }

            async assignPermissionToRole(roleId, permissionId, reason) {
                const response = await fetch(`/api/v1/activity/roles/${roleId}/permissions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ permission_id: permissionId, reason })
                });
                return response.json();
            }

            async assignRoleToUser(userId, roleId, reason) {
                const response = await fetch(`/api/v1/activity/users/${userId}/role`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ role_id: roleId, reason })
                });
                return response.json();
            }

            async getUserPermissions(userId) {
                const response = await fetch(`/api/v1/activity/users/${userId}/permissions/summary`);
                return response.json();
            }

            async checkPermission(userId, module, action, resource = 'all') {
                const response = await fetch(`/api/v1/activity/users/${userId}/check-permission`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ module, action, resource })
                });
                return response.json();
            }
        }

        // Initialize components when DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize activity timeline
            const timeline = new ActivityTimeline('activityTimeline');

            // Initialize permission manager
            const permissionManager = new PermissionManager();

            // Example: Load activities
            // timeline.loadActivities({ limit: 50 });

            console.log('Activity tracking components initialized');
        });
    </script>

</body>

</html>
